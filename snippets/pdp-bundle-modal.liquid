<div class="product-bundle__modal">
  <div class="product">
    <div class="product__media-wrapper">
      <div class="product__media-container">
        <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
          {{ "accessibility.skip_to_product_info" | t }}
        </a>
        <ul class="product__media-list swiper" role="list">
          {% if product.metafields.my_fields.product_card_badge != blank %}
                  <div class="product-tag">
                    <p class="body-4 bold">{{ product.metafields.my_fields.product_card_badge }}</p>
                  </div>
                  {% endif %}
          <div class="swiper-wrapper">
            {%- for media in product.media -%}
              {% assign alt_strip = media.alt | strip | downcase %}
              {% assign curr_varriant = product.selected_or_first_available_variant.title | downcase %}
              {% if curr_varriant contains alt_strip %}
                <li class="product__media-item swiper-slide{% if media.media_type != 'image' %} product__media-item--full{% endif %}" data-media-id="{{ section.id }}-{{ media.id }}">
                  
                  {% render 'product-thumbnail', media: media, position: forloop.index, loop: section.settings.enable_video_looping, modal_id: section.id, xr_button: true %}
                </li>
              {% endif %}
            {%- endfor -%}
          </div> 
    
          <div class="product__media-thumbnails">
            {% assign thumb_counter = 0 %}
            {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
            {% for media in product.media %}
              {% assign alt_strip = media.alt | strip | downcase %}
              {% assign curr_varriant = product.selected_or_first_available_variant.title | downcase %}
              {% if curr_varriant contains alt_strip %}
                <div class="product__slider-thumbnail-item{% if thumb_counter == 0 %} active{% endif %}" data-media-id="{{ section.id }}-{{ media.id }}" data-slideid="{{ thumb_counter }}">
                  {% render 'lazy-image' image: media.preview_image, blur: true, classes: 'img-fill' %}
                </div>

                {% assign thumb_counter = thumb_counter | plus: 1 %}
              {% endif %}
            {% endfor %}  
          </div>
        </ul>

        <div class="product__media-arrows">
          <div class="swiper-button swiper-button-next">
            {% render 'svg-arrow-button-right' %}
          </div>
          <div class="swiper-button swiper-button-prev">
            {% render 'svg-arrow-button-left' %}
          </div>
        </div>

      </div>
    </div>

    <div class="product__info-wrapper">
      <div id="ProductInfo-{{ section.id }}" class="product__info-container{% if section.settings.enable_sticky_info %} product__info-container--sticky{% endif %}">
        {%- assign product_form_id = 'product-form-' | append: section.id -%}

        <h1 class="product__title h2">
          {{ product.title | escape }}
        </h1>

        <div class="yotpo bottomLine"
          data-appkey="P3ppHFODI45UdcU4EDf74Cb6VxZcPOF3xSEqzmsq"
          data-domain="{{shop.permanent_domain | escape }}"
          data-product-id="{{ product.id }}"
          data-product-models="{{ product.id }}"
          data-name="{{ product.title | escape }}"
          data-url="{{ shop.url }}{{ product.url }}"
          data-image-url="{{ product.featured_image | product_img_url: 'large' |replace: '?', '%3F' | replace: '&','%26'}}"
          data-description="{{ product.description | escape }}"
          data-bread-crumbs="{% for tag in product.tags %}{{ tag | escape }};{% endfor %}">
        </div>
      

        <div class="no-js-hidden" id="price-{{ section.id }}">
          {%- render 'price', product: product, use_variant: true, show_badges: true, price_class: 'sh2' -%}
        </div>
    
        <div>
          {%- form 'product', product, id: 'product-form-installment', class: 'body-2' -%}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            {{ form | payment_terms }}
          {%- endform -%}
        </div>
    
        {%- unless product.has_only_default_variant -%}
          {%- if section.settings.picker_type == 'button' -%}
            <variant-radios class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
              {%- for option in product.options_with_values -%}

                {%- assign color_label = 'color,colour,couleur,colore,farbe,색,色,färg,farve' | split: ',' -%}
                {%- assign downcase_option = option.name | downcase -%}
                {%- assign variant_option = 'option' | append: forloop.index -%}

                  <fieldset class="js product-form__input{% if color_label contains downcase_option %} product-form__color-swatches{% endif %}"> 
                    {% comment %}
                      <legend class="form__label">{{ option.name }}</legend>
                    {% endcomment %}

                    <div class="product-form__variant-container">
                      <div class="product-form__variant-list">
                        
                        {%- for value in option.values -%}

                          {%- assign current_variant = '' -%}

                          <!-- Find colors within variants -->
                          {% for variant in product.variants %}
                            {%- if variant[variant_option] == value -%}
                              {%- assign current_variant = variant -%}
                              {%- assign active_color = value -%}
                            {%- endif -%}
                          {% endfor %}

                          {%- assign color_swatch_name = value | handleize | append: '.jpg' -%}
                          {%- assign color_swatch_image = images[color_swatch_name] -%}

                          <input type="radio" id="{{ section.id }}-{{ option.name }}-{{ forloop.index0 }}"
                                name="{{ option.name }}"
                                value="{{ value | escape }}"
                                form="product-form-{{ section.id }}"
                                data-name="{{ active_color }}"
                                data-id="{{product.variants[forloop.index0].id}}"
                                
                                {% if option.selected_value == value %}checked{% endif %}
                          >
                          <label {% if product.type == 'Gift Card' %}class="gift-card__label"{% endif %} for="{{ section.id }}-{{ option.name }}-{{ forloop.index0 }}"{% if color_label contains downcase_option %} style="background-image: url({{ color_swatch_image | img_url: '20x20' }});"{% endif %}>
                            {{ value }}
                          </label>
                        {%- endfor -%}
                      </div>

                      {% if color_label contains downcase_option %}
                        <div class="product-form__variant-active">
                          <p class="body-4 medium caps">{{ product.selected_or_first_available_variant[variant_option] }}</p>
                        </div>
                      {% endif %}

                    </div>
                    {% if product.type == 'Seating' %}
                    <div class="freeswatch__atc nav swatch-link">Try a Swatch</div>
                    {% endif %}
              </fieldset>
              {%- endfor -%}
              <script type="application/json">
                {{ product.variants | json }}
              </script>
            </variant-radios>
          {%- else -%}
            <variant-selects class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
              {%- for option in product.options_with_values -%}
                <div class="product-form__input product-form__input--dropdown">
                  <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                    {{ option.name }}
                  </label>
                  <div class="select">
                    <select id="Option-{{ section.id }}-{{ forloop.index0 }}"
                      class="select__select"
                      name="options[{{ option.name | escape }}]"
                      form="product-form-{{ section.id }}"
                    >
                      {%- for value in option.values -%}
                        <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                          {{ value }}
                        </option>
                      {%- endfor -%}
                    </select>
                    {% render 'icon-caret' %}
                  </div>
                </div>
              {%- endfor -%}

              <script type="application/json">
                {{ product.variants | json }}
              </script>
            </variant-selects>
          {%- endif -%}
        {%- endunless -%}

        <noscript>
          <div class="product-form__input{% if product.has_only_default_variant %} hidden{% endif %}">
            <label class="form__label" for="Variants-{{ section.id }}">{{ 'products.product.product_variants' | t }}</label>
            <div class="select">
              <select name="id" id="Variants-{{ section.id }}" class="select__select" form="product-form">
                {%- for variant in product.variants -%}
                  <option
                    {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %}
                    {% if variant.available == false %}disabled{% endif %}
                    value="{{ variant.id }}"
                  >
                    {{ variant.title }}
                    {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
                    - {{ variant.price | money | strip_html }}
                  </option>
                {%- endfor -%}
              </select>
              {% render 'icon-caret' %}
            </div>
          </div>
        </noscript>
        
        <div class="product__description-wrapper">
          {% if product.metafields.my_fields.mini_card_description != blank %}
            <p class="body medium">{{ product.metafields.my_fields.mini_card_description }}</p>
          {% endif %}

          {%- if product.description != blank -%}
            <div class="product__description body-1">
              {{ product.description }}
            </div>
          {%- endif -%}
        </div>
        
        {% for variant in product.variants %}
        {% if variant.metafields.my_fields.delivery_tag != blank %}
        <p style="{% if product.selected_or_first_available_variant.id == variant.id and variant.metafields.my_fields.delivery_tag != blank %}display: inline-block;{% endif %}" data-id="{{variant.id}}" class="product__shipping nav">{{ variant.metafields.my_fields.delivery_tag }}</p>
        {% endif %}
        {% endfor %}
        
        <product-form class="product-form">
          <button
            type="submit"
            name="add"
            class="product-form__submit button button--full-width {% if block.settings.show_dynamic_checkout and product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
            {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
          >
              Select
          </button>
        </product-form>

      </div>
    </div>
  </div>
</div>